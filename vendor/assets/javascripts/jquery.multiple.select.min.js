!function(e){"use strict";function t(t,i){var s=this,l=t.width();this.$el=t.hide(),this.options=i,this.$parent=e('<div class="ms-parent"></div>'),this.$choice=e('<button type="button" class="ms-choice"><span class="placeholder">'+i.placeholder+"</span><div></div></button>"),this.$drop=e('<div class="ms-drop"></div>'),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$choice.css("width",l+"px"),this.$drop.css({width:(i.width||l)+"px"}),e("body").click(function(t){e(t.target)[0]!==s.$choice[0]&&e(t.target).parents(".ms-choice")[0]!==s.$choice[0]&&(e(t.target)[0]!==s.$drop[0]&&e(t.target).parents(".ms-drop")[0]===s.$drop[0]||!s.options.isopen||s.close())}),this.options.isopen&&this.open()}t.prototype={constructor:t,init:function(){var t=this,i=[];this.options.filter&&i.push('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>"),i.push("<ul>"),this.options.selectAll&&i.push("<li>","<label>",'<input type="checkbox" name="selectAll" /> ',"["+this.options.selectAllText+"]","</label>","</li>"),e.each(this.$el.children(),function(e,s){i.push(t.optionToHtml(e,s))}),i.push("</ul>"),this.$drop.html(i.join("")),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find('input[name="selectAll"]'),this.$selectGroups=this.$drop.find('input[name="selectGroup"]'),this.$selectItems=this.$drop.find('input[name="selectItem"]:enabled'),this.$disableItems=this.$drop.find('input[name="selectItem"]:disabled'),this.events(),this.update()},optionToHtml:function(t,i,s,l){var c,o=this,n=e(i),h=[],p=this.options.multiple;if(n.is("option")){var a=n.val(),r=n.text(),d=n.prop("selected");c=l||n.prop("disabled"),h.push("<li"+(p?' class="multiple"':"")+">","<label"+(c?' class="disabled"':"")+">",'<input type="checkbox" name="selectItem" value="'+a+'"'+(d?' checked="checked"':"")+(c?' disabled="disabled"':"")+(s?' data-group="'+s+'"':"")+"/> ",r,"</label>","</li>")}else if(!s&&n.is("optgroup")){var u="group_"+t,f=n.attr("label");c=n.prop("disabled"),h.push('<li class="group">','<label class="optgroup'+(c?" disabled":"")+'" data-group="'+u+'">','<input type="checkbox" name="selectGroup"'+(c?' disabled="disabled"':"")+" /> ",f,"</label>","</li>"),e.each(n.children(),function(e,t){h.push(o.optionToHtml(e,t,u,c))})}return h.join("")},events:function(){var t=this;this.$choice.off("click").on("click",function(){t[t.options.isopen?"close":"open"]()}),this.$parent.off("keydown").on("keydown",function(e){switch(e.which){case 27:t.close(),t.$choice.focus()}}),this.$searchInput.off("keyup").on("keyup",function(){t.filter()}),this.$selectAll.off("click").on("click",function(){var i=e(this).prop("checked"),s=t.$selectItems.filter(":visible");s.length===t.$selectItems.length?t[i?"checkAll":"uncheckAll"]():(t.$selectGroups.prop("checked",i),s.prop("checked",i),t.update())}),this.$selectGroups.off("click").on("click",function(){var i=e(this).parent().attr("data-group"),s=t.$selectItems.filter(":visible"),l=s.filter('[data-group="'+i+'"]'),c=l.length!==l.filter(":checked").length;l.prop("checked",c),t.updateSelectAll(),t.update(),t.options.onOptgroupClick({label:e(this).parent().text(),checked:c,children:l.get()})}),this.$selectItems.off("click").on("click",function(){t.updateSelectAll(),t.update(),t.updateOptGroupSelect(),t.options.onClick({label:e(this).parent().text(),value:e(this).val(),checked:e(this).prop("checked")})})},open:function(){if(!this.$choice.hasClass("disabled")){if(this.options.isopen=!0,this.$choice.find(">div").addClass("open"),this.$drop.show(),this.options.container){var t=this.$drop.offset();this.$drop.appendTo(e(this.options.container)),this.$drop.offset({top:t.top,left:t.left})}this.options.filter&&(this.$searchInput.val(""),this.filter()),this.options.onOpen()}},close:function(){this.options.isopen=!1,this.$choice.find(">div").removeClass("open"),this.$drop.hide(),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},update:function(){var e=this.getSelects("text"),t=this.$choice.find(">span");e.length?t.removeClass("placeholder").html(e.join(", ")):t.addClass("placeholder").html(this.options.placeholder),this.$el.val(this.getSelects())},updateSelectAll:function(){var e=this.$selectItems.filter(":visible");this.$selectAll.prop("checked",e.length&&e.length===e.filter(":checked").length)},updateOptGroupSelect:function(){var t=this.$selectItems.filter(":visible");e.each(this.$selectGroups,function(i,s){var l=e(s).parent().attr("data-group"),c=t.filter('[data-group="'+l+'"]');e(s).prop("checked",c.length&&c.length===c.filter(":checked").length)})},getSelects:function(t){var i=this,s=[],l=[];return this.$drop.find('input[name="selectItem"]:checked').each(function(){s.push(e(this).parent().text()),l.push(e(this).val())}),"text"===t&&this.$selectGroups.length&&(s=[],this.$selectGroups.each(function(){var t=[],l=e.trim(e(this).parent().text()),c=e(this).parent().data("group"),o=i.$drop.find('[name="selectItem"][data-group="'+c+'"]'),n=o.filter(":checked");if(0!==n.length){if(t.push("["),t.push(l),o.length>n.length){var h=[];n.each(function(){h.push(e(this).parent().text())}),t.push(": "+h.join(", "))}t.push("]"),s.push(t.join(""))}})),"text"===t?s:l},setSelects:function(t){var i=this;this.$selectItems.prop("checked",!1),e.each(t,function(e,t){i.$selectItems.filter('[value="'+t+'"]').prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},refresh:function(){this.init()},filter:function(){var t=this,i=e.trim(this.$searchInput.val()).toLowerCase();0===i.length?(this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show()):(this.$selectItems.each(function(){var t=e(this).parent();t[t.text().toLowerCase().indexOf(i)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var i=e(this).parent(),s=i.attr("data-group"),l=t.$selectItems.filter(":visible");i[0===l.filter('[data-group="'+s+'"]').length?"hide":"show"]()})),this.updateOptGroupSelect(),this.updateSelectAll()}},e.fn.multipleSelect=function(){var i,s=arguments[0],l=arguments,c=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","refresh"];return this.each(function(){var o=e(this),n=o.data("multipleSelect"),h=e.extend({},e.fn.multipleSelect.defaults,"object"==typeof s&&s);if(n||(n=new t(o,h),o.data("multipleSelect",n)),"string"==typeof s){if(e.inArray(s,c)<0)throw"Unknown method: "+s;i=n[s](l[1])}else n.init()}),i?i:this},e.fn.multipleSelect.defaults={isopen:!1,placeholder:"",selectAll:!0,selectAllText:"Select all",multiple:!1,multipleWidth:80,filter:!1,width:void 0,maxHeight:250,container:null,onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}}(jQuery);